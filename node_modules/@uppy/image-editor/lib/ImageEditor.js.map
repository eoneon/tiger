{"version":3,"names":["UIPlugin","h","Editor","packageJson","locale","ImageEditor","constructor","uppy","opts","save","saveBlobCallback","blob","currentImage","getPluginState","setFileState","id","data","size","preview","updatedFile","getFile","emit","setPluginState","cropper","getCroppedCanvas","cropperOptions","croppedCanvasOptions","toBlob","type","quality","storeCropperInstance","selectFile","file","title","defaultLocale","defaultCropperOptions","viewMode","background","autoCropArea","responsive","defaultActions","revert","rotate","granularRotate","flip","zoomIn","zoomOut","cropSquare","cropWidescreen","cropWidescreenVertical","defaultOptions","actions","i18nInit","canEditFile","isRemote","fileTypeSpecific","split","test","install","target","mount","uninstall","unmount","render","i18n","VERSION","version"],"sources":["ImageEditor.jsx"],"sourcesContent":["import { UIPlugin } from '@uppy/core'\nimport { h } from 'preact'\n\nimport Editor from './Editor.jsx'\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\nexport default class ImageEditor extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'ImageEditor'\n    this.title = 'Image Editor'\n    this.type = 'editor'\n\n    this.defaultLocale = locale\n\n    const defaultCropperOptions = {\n      viewMode: 1,\n      background: false,\n      autoCropArea: 1,\n      responsive: true,\n      croppedCanvasOptions: {},\n    }\n\n    const defaultActions = {\n      revert: true,\n      rotate: true,\n      granularRotate: true,\n      flip: true,\n      zoomIn: true,\n      zoomOut: true,\n      cropSquare: true,\n      cropWidescreen: true,\n      cropWidescreenVertical: true,\n    }\n\n    const defaultOptions = {\n      quality: 0.8,\n    }\n\n    this.opts = {\n      ...defaultOptions,\n      ...opts,\n      actions: {\n        ...defaultActions,\n        ...opts.actions,\n      },\n      cropperOptions: {\n        ...defaultCropperOptions,\n        ...opts.cropperOptions,\n      },\n    }\n\n    this.i18nInit()\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  canEditFile (file) {\n    if (!file.type || file.isRemote) {\n      return false\n    }\n\n    const fileTypeSpecific = file.type.split('/')[1]\n\n    if (/^(jpe?g|gif|png|bmp|webp)$/.test(fileTypeSpecific)) {\n      return true\n    }\n\n    return false\n  }\n\n  save = () => {\n    const saveBlobCallback = (blob) => {\n      const { currentImage } = this.getPluginState()\n\n      this.uppy.setFileState(currentImage.id, {\n        data: blob,\n        size: blob.size,\n        preview: null,\n      })\n\n      const updatedFile = this.uppy.getFile(currentImage.id)\n      this.uppy.emit('thumbnail:request', updatedFile)\n      this.setPluginState({\n        currentImage: updatedFile,\n      })\n      this.uppy.emit('file-editor:complete', updatedFile)\n    }\n\n    const { currentImage } = this.getPluginState()\n\n    this.cropper.getCroppedCanvas(this.opts.cropperOptions.croppedCanvasOptions).toBlob(\n      saveBlobCallback,\n      currentImage.type,\n      this.opts.quality,\n    )\n  }\n\n  storeCropperInstance = (cropper) => {\n    this.cropper = cropper\n  }\n\n  selectFile = (file) => {\n    this.uppy.emit('file-editor:start', file)\n    this.setPluginState({\n      currentImage: file,\n    })\n  }\n\n  install () {\n    this.setPluginState({\n      currentImage: null,\n    })\n\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    const { currentImage } = this.getPluginState()\n\n    if (currentImage) {\n      const file = this.uppy.getFile(currentImage.id)\n      this.uppy.emit('file-editor:cancel', file)\n    }\n    this.unmount()\n  }\n\n  render () {\n    const { currentImage } = this.getPluginState()\n\n    if (currentImage === null || currentImage.isRemote) {\n      return null\n    }\n\n    return (\n      <Editor\n        currentImage={currentImage}\n        storeCropperInstance={this.storeCropperInstance}\n        save={this.save}\n        opts={this.opts}\n        i18n={this.i18n}\n      />\n    )\n  }\n}\n"],"mappings":"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"}