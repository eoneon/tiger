{"version":3,"names":["nanoid","packageJson","STATE_UPDATE","defaultSelector","id","state","uppy","getPatch","prev","next","nextKeys","Object","keys","patch","forEach","k","Symbol","for","ReduxStore","constructor","opts","store","selector","setState","dispatch","type","payload","getState","subscribe","cb","prevState","nextState","VERSION","version","reducer","action","newState","middleware"],"sources":["index.js"],"sourcesContent":["import { nanoid } from 'nanoid/non-secure'\n\nimport packageJson from '../package.json'\n\n// Redux action name.\nexport const STATE_UPDATE = 'uppy/STATE_UPDATE'\n\n// Pluck Uppy state from the Redux store in the default location.\nconst defaultSelector = (id) => (state) => state.uppy[id]\n\nfunction getPatch (prev, next) {\n  const nextKeys = Object.keys(next)\n  const patch = {}\n  nextKeys.forEach((k) => {\n    if (prev[k] !== next[k]) patch[k] = next[k]\n  })\n  return patch\n}\n\n/**\n * Redux store.\n *\n * @param {object} opts.store - The Redux store to use.\n * @param {string} opts.id - This store instance's ID. Defaults to a random string.\n *    If you need to access Uppy state through Redux, eg. to render custom UI, set this to something constant.\n * @param {Function} opts.selector - Function, `(state) => uppyState`, to pluck state from the Redux store.\n *    Defaults to retrieving `state.uppy[opts.id]`. Override if you placed Uppy state elsewhere in the Redux store.\n */\nexport class ReduxStore {\n  static VERSION = packageJson.version\n\n  #id\n\n  #selector\n\n  #store\n\n  constructor (opts) {\n    this.#store = opts.store\n    this.#id = opts.id || nanoid()\n    this.#selector = opts.selector || defaultSelector(this.#id)\n\n    // Calling `setState` to dispatch an action to the Redux store.\n    // The intent is to make sure that the reducer has run once.\n    this.setState({})\n  }\n\n  setState (patch) {\n    this.#store.dispatch({\n      type: STATE_UPDATE,\n      id: this.#id,\n      payload: patch,\n    })\n  }\n\n  getState () {\n    return this.#selector(this.#store.getState())\n  }\n\n  subscribe (cb) {\n    let prevState = this.getState()\n    return this.#store.subscribe(() => {\n      const nextState = this.getState()\n      if (prevState !== nextState) {\n        const patch = getPatch(prevState, nextState)\n        cb(prevState, nextState, patch)\n        prevState = nextState\n      }\n    })\n  }\n\n  [Symbol.for('uppy test: get id')] () {\n    return this.#id\n  }\n}\n\nexport function reducer (state = {}, action) {\n  if (action.type === STATE_UPDATE) {\n    const newState = { ...state[action.id], ...action.payload }\n    return { ...state, [action.id]: newState }\n  }\n  return state\n}\n\nexport function middleware () {\n  // Do nothing, at the moment.\n  return () => (next) => (action) => {\n    next(action)\n  }\n}\n\nexport default ReduxStore\n"],"mappings":";;;;;;;;AAAA,SAASA,MAAT,QAAuB,mBAAvB;MAEOC,W;;GAEP;;AACA,OAAO,MAAMC,YAAY,GAAG,mBAArB,C,CAEP;;AACA,MAAMC,eAAe,GAAIC,EAAD,IAASC,KAAD,IAAWA,KAAK,CAACC,IAAN,CAAWF,EAAX,CAA3C;;AAEA,SAASG,QAAT,CAAmBC,IAAnB,EAAyBC,IAAzB,EAA+B;EAC7B,MAAMC,QAAQ,GAAGC,MAAM,CAACC,IAAP,CAAYH,IAAZ,CAAjB;EACA,MAAMI,KAAK,GAAG,EAAd;EACAH,QAAQ,CAACI,OAAT,CAAkBC,CAAD,IAAO;IACtB,IAAIP,IAAI,CAACO,CAAD,CAAJ,KAAYN,IAAI,CAACM,CAAD,CAApB,EAAyBF,KAAK,CAACE,CAAD,CAAL,GAAWN,IAAI,CAACM,CAAD,CAAf;EAC1B,CAFD;EAGA,OAAOF,KAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;cA4CGG,MAAM,CAACC,GAAP,CAAW,mBAAX,C;AA3CH,OAAO,MAAMC,UAAN,CAAiB;EAStBC,WAAW,CAAEC,IAAF,EAAQ;IAAA;MAAA;MAAA;IAAA;IAAA;MAAA;MAAA;IAAA;IAAA;MAAA;MAAA;IAAA;IACjB,oDAAcA,IAAI,CAACC,KAAnB;IACA,8CAAWD,IAAI,CAAChB,EAAL,IAAWJ,MAAM,EAA5B;IACA,0DAAiBoB,IAAI,CAACE,QAAL,IAAiBnB,eAAe,6BAAC,IAAD,YAAjD,CAHiB,CAKjB;IACA;;IACA,KAAKoB,QAAL,CAAc,EAAd;EACD;;EAEDA,QAAQ,CAAEV,KAAF,EAAS;IACf,kDAAYW,QAAZ,CAAqB;MACnBC,IAAI,EAAEvB,YADa;MAEnBE,EAAE,8BAAE,IAAF,WAFiB;MAGnBsB,OAAO,EAAEb;IAHU,CAArB;EAKD;;EAEDc,QAAQ,GAAI;IACV,mCAAO,IAAP,wBAAsB,kDAAYA,QAAZ,EAAtB;EACD;;EAEDC,SAAS,CAAEC,EAAF,EAAM;IACb,IAAIC,SAAS,GAAG,KAAKH,QAAL,EAAhB;IACA,OAAO,kDAAYC,SAAZ,CAAsB,MAAM;MACjC,MAAMG,SAAS,GAAG,KAAKJ,QAAL,EAAlB;;MACA,IAAIG,SAAS,KAAKC,SAAlB,EAA6B;QAC3B,MAAMlB,KAAK,GAAGN,QAAQ,CAACuB,SAAD,EAAYC,SAAZ,CAAtB;QACAF,EAAE,CAACC,SAAD,EAAYC,SAAZ,EAAuBlB,KAAvB,CAAF;QACAiB,SAAS,GAAGC,SAAZ;MACD;IACF,CAPM,CAAP;EAQD;;EAED,gBAAqC;IACnC,mCAAO,IAAP;EACD;;AA7CqB;AAAXb,U,CACJc,O,GAAU/B,WAAW,CAACgC,O;AA+C/B,OAAO,SAASC,OAAT,CAAkB7B,KAAlB,EAA8B8B,MAA9B,EAAsC;EAAA,IAApB9B,KAAoB;IAApBA,KAAoB,GAAZ,EAAY;EAAA;;EAC3C,IAAI8B,MAAM,CAACV,IAAP,KAAgBvB,YAApB,EAAkC;IAChC,MAAMkC,QAAQ,GAAG,EAAE,GAAG/B,KAAK,CAAC8B,MAAM,CAAC/B,EAAR,CAAV;MAAuB,GAAG+B,MAAM,CAACT;IAAjC,CAAjB;IACA,OAAO,EAAE,GAAGrB,KAAL;MAAY,CAAC8B,MAAM,CAAC/B,EAAR,GAAagC;IAAzB,CAAP;EACD;;EACD,OAAO/B,KAAP;AACD;AAED,OAAO,SAASgC,UAAT,GAAuB;EAC5B;EACA,OAAO,MAAO5B,IAAD,IAAW0B,MAAD,IAAY;IACjC1B,IAAI,CAAC0B,MAAD,CAAJ;EACD,CAFD;AAGD;AAED,eAAejB,UAAf"}